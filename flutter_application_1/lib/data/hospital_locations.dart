/// รายการสถานที่ในโรงพยาบาลสำหรับจุดรับ/จุดส่ง
class HospitalLocations {
  static const List<String> allLocations = [
    // 1. อาคารสุจิณโณ - โซนอายุรกรรม
    'หอผู้ป่วยอายุรกรรมชาย 3 (ตึกสุจิณโณ ชั้น 5)',
    'หอผู้ป่วยอายุรกรรมหญิง 1 (ตึกสุจิณโณ ชั้น 11)',
    'หอผู้ป่วยอายุรกรรมหญิง 2 (ตึกสุจิณโณ ชั้น 11)',
    'หอผู้ป่วยอายุรกรรมหญิง 3 (ตึกสุจิณโณ ชั้น 11)',
    // โซนศัลยกรรม
    'หอผู้ป่วยศัลยกรรมชาย 1 (ตึกสุจิณโณ ชั้น 7)',
    'หอผู้ป่วยศัลยกรรมชาย 2 (ตึกสุจิณโณ ชั้น 7)',
    'หอผู้ป่วยศัลยกรรมชาย 3 (ตึกสุจิณโณ ชั้น 7)',
    'หอผู้ป่วยศัลยกรรมหญิง 1 (ตึกสุจิณโณ ชั้น 8)',
    'หอผู้ป่วยศัลยกรรมหญิง 2 (ตึกสุจิณโณ ชั้น 8)',
    'หอผู้ป่วยศัลยกรรมหญิง 3 (ตึกสุจิณโณ ชั้น 8)',
    // โซนกระดูกและข้อ
    'หอผู้ป่วยกระดูกหญิง 1 (ตึกสุจิณโณ ชั้น 4)',
    'หอผู้ป่วยกระดูกหญิง 2 (ตึกสุจิณโณ ชั้น 4)',
    'หอผู้ป่วยกระดูกเด็ก (ตึกสุจิณโณ ชั้น 4)',
    'ICU Ortho (ตึกสุจิณโณ ชั้น 4)',
    'Ortho Spine (ตึกสุจิณโณ ชั้น 4)',
    'ห้องกายภาพบำบัด (ตึกสุจิณโณ ชั้น 4)',
    // โซนตา หู คอ จมูก
    'หอผู้ป่วยจักษุ 1 (ตึกสุจิณโณ ชั้น 9)',
    'หอผู้ป่วยจักษุ 2 (ตึกสุจิณโณ ชั้น 9)',
    'หอผู้ป่วยโสต ศอ นาสิก 1 (ตึกสุจิณโณ ชั้น 10)',
    'หอผู้ป่วยโสต ศอ นาสิก 2 (ตึกสุจิณโณ ชั้น 10)',
    // โซนพิเศษ
    'หอผู้ป่วยนรีเวช Gyne (ตึกสุจิณโณ ชั้น 3)',
    'หอผู้ป่วยพิเศษสุจิณโณ 12 (ตึกสุจิณโณ ชั้น 12)',
    'หอผู้ป่วยพิเศษสุจิณโณ 13 (ตึกสุจิณโณ ชั้น 13)',
    'หอผู้ป่วยพิเศษสุจิณโณ 14 (ตึกสุจิณโณ ชั้น 14)',

    // 2. อาคารบุญสม มาร์ติน - โซนวิกฤตและห้องผ่าตัด
    'ICU ศัลยกรรม (ตึกบุญสม ชั้น 2)',
    'วิกฤตศัลยกรรมอุบัติเหตุ Trauma (ตึกบุญสม ชั้น 2)',
    'วิกฤตศัลยกรรมฉุกเฉิน (ตึกบุญสม ชั้น 2)',
    'ศูนย์แผลไหม้ Burn Unit (ตึกบุญสม ชั้น 2)',
    'ห้องผ่าตัดใหญ่ OR (ตึกบุญสม ชั้น 2)',
    'ห้องพักฟื้น Recovery Room (ตึกบุญสม ชั้น 2)',
    // โซนแม่และเด็ก
    'ห้องคลอด (ตึกบุญสม ชั้น 3)',
    'หอผู้ป่วยสูติกรรม (ตึกบุญสม ชั้น 3)',
    'ICU สูติ-นรีเวช (ตึกบุญสม ชั้น 3)',
    'หอผู้ป่วยกุมาร 1 (ตึกบุญสม ชั้น 6)',
    'หอผู้ป่วยกุมาร 2 (ตึกบุญสม ชั้น 6)',
    'หอผู้ป่วยกุมาร 3 (ตึกบุญสม ชั้น 6)',
    'หอผู้ป่วยกุมาร 4 (ตึกบุญสม ชั้น 6)',
    'หอผู้ป่วยกุมาร 5 (ตึกบุญสม ชั้น 6)',
    // โซนอื่นๆ
    'หอผู้ป่วยกระดูกชาย 1 (ตึกบุญสม ชั้น 4)',
    'หอผู้ป่วยกระดูกชาย 2 (ตึกบุญสม ชั้น 4)',
    'หอผู้ป่วยกระดูกชาย 3 (ตึกบุญสม ชั้น 4)',
    'หอผู้ป่วยอายุรกรรมชาย 1 (ตึกบุญสม ชั้น 5)',
    'หอผู้ป่วยอายุรกรรมชาย 2 (ตึกบุญสม ชั้น 5)',

    // 3. อาคารเฉลิมพระบารมี
    'ICU อายุรกรรม Med (ตึกเฉลิมพระบารมี ชั้น 5)',
    'Sub ICU อายุรกรรม 1 (ตึกเฉลิมพระบารมี ชั้น 5)',
    'Sub ICU อายุรกรรม 2 (ตึกเฉลิมพระบารมี ชั้น 5)',
    'NICU 1 ทารกแรกเกิด (ตึกเฉลิมพระบารมี ชั้น 6)',
    'NICU 2 ทารกแรกเกิด (ตึกเฉลิมพระบารมี ชั้น 6)',
    'PICU กุมารเวชบำบัดวิกฤต (ตึกเฉลิมพระบารมี ชั้น 6)',
    'ICU ศัลยกรรมประสาท Neuro (ตึกเฉลิมพระบารมี ชั้น 7)',
    'ICU หัวใจและทรวงอก CVT (ตึกเฉลิมพระบารมี ชั้น 7)',

    // 4. อาคารศรีพัฒน์
    'ICU Neuro ศัลยกรรมประสาท (ตึกศรีพัฒน์ ชั้น 3)',
    'CCU 1 โรคหัวใจ (ตึกศรีพัฒน์ ชั้น 8)',
    'CCU 2 โรคหัวใจ (ตึกศรีพัฒน์ ชั้น 8)',
    'Stroke Unit โรคหลอดเลือดสมอง (ตึกศรีพัฒน์ ชั้น 9)',

    // 5. อาคารตะวัน กังวานพงศ์
    'หอผู้ป่วยพิเศษตะวัน 4 (ตึกตะวัน ชั้น 4)',
    'หอผู้ป่วยพิเศษตะวัน 5 (ตึกตะวัน ชั้น 5)',
    'หอผู้ป่วยพิเศษตะวัน 6 (ตึกตะวัน ชั้น 6)',

    // 6. อาคารผู้ป่วยนอก (OPD) & ฉุกเฉิน
    'ห้องฉุกเฉินอุบัติเหตุ Trauma (อาคารฉุกเฉิน ชั้น 1)',
    'ห้องฉุกเฉินทั่วไป Non-Trauma (อาคารฉุกเฉิน ชั้น 1)',
    'ห้องตรวจเบอร์ 1 ศัลยกรรม (อาคาร OPD ชั้น 1)',
    'ห้องตรวจเบอร์ 2 ศัลยกรรม (อาคาร OPD ชั้น 1)',
    'ห้องตรวจเบอร์ 3 นรีเวช (อาคาร OPD ชั้น 2)',
    'ห้องตรวจเบอร์ 4 ฝากครรภ์ (อาคาร OPD ชั้น 2)',
    'ห้องตรวจเบอร์ 5 วางแผนครอบครัว (อาคาร OPD ชั้น 2)',
    'ห้องตรวจเบอร์ 6 หู คอ จมูก (อาคาร OPD ชั้น 5)',
    'ห้องตรวจเบอร์ 7 จักษุ (อาคาร OPD ชั้น 6)',
    'ห้องตรวจเบอร์ 9 อายุรกรรม (อาคาร OPD ชั้น 2)',
    'ห้องตรวจเบอร์ 10 กระดูกและข้อ (อาคาร OPD ชั้น 2)',
    'ห้องตรวจเบอร์ 24 จิตเวช (อาคาร OPD ชั้น 3)',
    'ห้องตรวจเบอร์ 25 ทันตกรรม (อาคาร OPD ชั้น 4)',
    'ห้องตรวจเบอร์ 27 วัคซีนเด็ก (อาคาร OPD ชั้น 3)',
    'ห้องตรวจเบอร์ 28 โรคเด็ก (อาคาร OPD ชั้น 3)',
  ];

  // ชื่อตึกสำหรับใช้จับคู่
  static const Map<String, String> buildingNames = {
    'สุจิณโณ': 'ตึกสุจิณโณ',
    'บุญสม': 'ตึกบุญสม',
    'เฉลิมพระบารมี': 'ตึกเฉลิมพระบารมี',
    'ศรีพัฒน์': 'ตึกศรีพัฒน์',
    'ตะวัน': 'ตึกตะวัน',
    'ฉุกเฉิน': 'อาคารฉุกเฉิน',
    'opd': 'อาคาร OPD',
  };

  /// หาสถานที่ที่ตรงกับคำพูดมากที่สุด หรือแปลงเป็น "ตึก + ห้อง"
  static String? matchLocation(String input) {
    if (input.isEmpty) return null;

    // ดึงเลขห้องที่อยู่หลังคำว่า "ห้อง" เท่านั้น
    String? roomNumber;
    final roomMatch = RegExp(
      r'ห้อง\s*(\d+)',
      caseSensitive: false,
    ).firstMatch(input);
    if (roomMatch != null) {
      roomNumber = roomMatch.group(1);
    }

    // ลบส่วน "ห้อง XXX" ออกจาก input ก่อนจับคู่สถานที่
    final inputWithoutRoom = input.replaceAll(RegExp(r'ห้อง\s*\d+'), '').trim();
    final inputLower = inputWithoutRoom.toLowerCase();

    // ลองจับคู่กับ allLocations ก่อน
    final inputClean = inputLower.replaceAll(' ', '');
    String? bestMatch;
    int bestScore = 0;

    for (final location in allLocations) {
      final locationLower = location.toLowerCase().replaceAll(' ', '');

      int score = 0;

      if (locationLower.contains(inputClean)) {
        score = inputClean.length * 2;
      }

      if (inputClean.contains(locationLower)) {
        score = locationLower.length * 2;
      }

      final keywords = _extractKeywords(inputWithoutRoom);
      for (final keyword in keywords) {
        if (locationLower.contains(keyword.toLowerCase())) {
          score += keyword.length;
        }
      }

      if (score > bestScore) {
        bestScore = score;
        bestMatch = location;
      }
    }

    // ถ้าพบสถานที่ ให้เพิ่มเลขห้องต่อท้าย (ถ้ามี)
    if (bestMatch != null && bestScore > 3) {
      if (roomNumber != null && roomNumber.isNotEmpty) {
        return '$bestMatch ห้อง $roomNumber';
      }
      return bestMatch;
    }

    // ถ้าไม่พบจาก allLocations ลองจับคู่กับชื่อตึก
    for (final entry in buildingNames.entries) {
      if (inputLower.contains(entry.key.toLowerCase())) {
        if (roomNumber != null && roomNumber.isNotEmpty) {
          return '${entry.value} ห้อง $roomNumber';
        }
        return entry.value;
      }
    }

    return bestScore > 3 ? bestMatch : null;
  }

  /// ดึงคำสำคัญจาก input
  static List<String> _extractKeywords(String input) {
    final keywords = <String>[];
    final text = input.toLowerCase();

    // ตัวเลข
    final numbers = RegExp(r'\d+').allMatches(text);
    for (final match in numbers) {
      keywords.add(match.group(0)!);
    }

    // คำสำคัญ
    final importantWords = [
      'icu',
      'ccu',
      'nicu',
      'picu',
      'or',
      'opd',
      'er',
      'อายุรกรรม',
      'ศัลยกรรม',
      'กระดูก',
      'กุมาร',
      'สูติ',
      'นรีเวช',
      'จักษุ',
      'โสต',
      'ฉุกเฉิน',
      'ตะวัน',
      'สุจิณโณ',
      'บุญสม',
      'ศรีพัฒน์',
      'ชาย',
      'หญิง',
      'เด็ก',
      'พิเศษ',
      'วิกฤต',
      'ห้องผ่าตัด',
      'ห้องคลอด',
      'trauma',
      'neuro',
      'ortho',
      'stroke',
      'burn',
    ];

    for (final word in importantWords) {
      if (text.contains(word.toLowerCase())) {
        keywords.add(word);
      }
    }

    return keywords;
  }
}
